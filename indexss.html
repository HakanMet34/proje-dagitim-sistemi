<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proje Daƒüƒ±tƒ±m Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header h1 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 32px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 10px 24px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 15px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .logout-btn, .settings-btn {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover, .settings-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .logout-btn {
            background: #ff4757;
            border-color: #ff4757;
            color: white;
        }

        .logout-btn:hover {
            background: #ff3838;
            border-color: #ff3838;
        }

        .login-container {
            background: white;
            padding: 50px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 450px;
            margin: 100px auto;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .login-container h2 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
            font-weight: 800;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 700;
            font-size: 14px;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            background: white;
            padding: 14px 28px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 700;
            color: #666;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.18);
        }

        .stat-card h3 {
            color: #666;
            font-size: 13px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        .stat-card .number {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .content-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
            margin-bottom: 30px;
        }

        .content-card h2 {
            color: #667eea;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 800;
        }

        .products-grid {
            display: grid;
            gap: 25px;
        }

        .product-card {
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            padding: 25px;
            transition: all 0.3s;
            position: relative;
            background: linear-gradient(to bottom, #ffffff, #fafafa);
        }

        .product-card:hover {
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            transform: translateY(-3px);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .product-title {
            font-size: 20px;
            font-weight: 800;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-beklemede {
            background: #fff4e6;
            color: #ff9800;
        }

        .status-devam {
            background: #e3f2fd;
            color: #2196f3;
        }

        .status-tamamlandi {
            background: #e8f5e9;
            color: #4caf50;
        }

        .status-iptal {
            background: #ffebee;
            color: #f44336;
        }

        .ad-active-badge {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .product-details {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .product-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 14px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .product-detail strong {
            color: #333;
            font-weight: 700;
        }

        .product-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 13px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #43a047;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #e53935;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .btn-warning:hover {
            background: #fb8c00;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        .btn-ad {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-ad:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 20px;
            max-width: 650px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h3 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: 800;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 32px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-modal:hover {
            color: #333;
            transform: rotate(90deg);
        }

        .chat-container {
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            background: #fafafa;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 14px;
            border-radius: 12px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chat-message.admin {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .chat-author {
            font-weight: 700;
            color: #667eea;
            font-size: 14px;
        }

        .chat-time {
            font-size: 12px;
            color: #999;
        }

        .chat-text {
            color: #333;
            font-size: 14px;
            line-height: 1.6;
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
        }

        .send-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
        }

        .send-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .uploaded-files {
            margin-top: 20px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .file-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .file-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 700;
            word-break: break-all;
        }

        .file-link:hover {
            text-decoration: underline;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px 25px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 350px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left: 5px solid #4caf50;
        }

        .notification.error {
            border-left: 5px solid #f44336;
        }

        .notification.info {
            border-left: 5px solid #2196f3;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .team-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .team-card h3 {
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: 800;
        }

        .team-stat {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 14px;
        }

        .timeline {
            position: relative;
            padding-left: 35px;
            margin-top: 25px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 25px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -41px;
            top: 5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #667eea;
        }

        .timeline-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .timeline-content {
            color: #333;
            line-height: 1.7;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.3s;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: stretch;
            }

            .header h1 {
                font-size: 24px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .product-header {
                flex-direction: column;
            }

            .product-actions {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 72px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-section select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            min-width: 160px;
            font-weight: 600;
        }

        .settings-card {
            background: linear-gradient(to bottom right, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .settings-card h3 {
            font-size: 20px;
            margin-bottom: 20px;
            font-weight: 800;
        }

        .settings-item {
            background: rgba(255,255,255,0.15);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .settings-item strong {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.9;
        }

        .settings-item input {
            background: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            width: 100%;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <h2>üöÄ Proje Daƒüƒ±tƒ±m Sistemi</h2>
        <div class="form-group">
            <label>Kullanƒ±cƒ± Adƒ±</label>
            <input type="text" id="loginUsername" placeholder="Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin" autocomplete="username">
        </div>
        <div class="form-group">
            <label>≈ûifre</label>
            <input type="password" id="loginPassword" placeholder="≈ûifrenizi girin" autocomplete="current-password">
        </div>
        <button class="btn" onclick="login()">üîê Giri≈ü Yap</button>
    </div>

    <div id="mainScreen" style="display: none;">
        <div class="container">
            <div class="header">
                <h1>üöÄ Proje Daƒüƒ±tƒ±m Sistemi</h1>
                <div class="user-info">
                    <div class="user-badge" id="userBadge"></div>
                    <button class="settings-btn" onclick="switchTab('settings')" id="settingsBtn" style="display:none;">‚öôÔ∏è Ayarlar</button>
                    <button class="logout-btn" onclick="logout()">üö™ √áƒ±kƒ±≈ü</button>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</div>
                <div class="tab" onclick="switchTab('products')" id="tabProducts">üì¶ Projeler</div>
                <div class="tab" onclick="switchTab('myTasks')" id="tabMyTasks" style="display:none;">‚úÖ G√∂revlerim</div>
                <div class="tab" onclick="switchTab('team')" id="tabTeam" style="display:none;">üë• Ekip</div>
                <div class="tab" onclick="switchTab('archive')">üìÅ Ar≈üiv</div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Toplam Proje</h3>
                        <div class="number" id="totalProducts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Bekleyen</h3>
                        <div class="number" id="pendingProducts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Devam Eden</h3>
                        <div class="number" id="inProgressProducts">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Tamamlanan</h3>
                        <div class="number" id="completedProducts">0</div>
                    </div>
                </div>

                <div class="content-card">
                    <h2>üìà Ekip Performansƒ±</h2>
                    <div class="team-grid" id="teamPerformance"></div>
                </div>

                <div class="content-card">
                    <h2>üîî Son Aktiviteler</h2>
                    <div class="timeline" id="activityTimeline"></div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="productsTab" class="tab-content">
                <div class="content-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                        <h2>üì¶ Proje Y√∂netimi</h2>
                        <button class="btn" style="width: auto; padding: 12px 28px;" onclick="openAddProductModal()" id="addProductBtn">‚ûï Yeni Proje Ekle</button>
                    </div>

                    <div class="filter-section">
                        <select id="filterStatus" onchange="filterProducts()">
                            <option value="all">üîç T√ºm Durumlar</option>
                            <option value="beklemede">‚è∏Ô∏è Beklemede</option>
                            <option value="devam">‚è≥ Devam Ediyor</option>
                            <option value="tamamlandi">‚úÖ Tamamlandƒ±</option>
                            <option value="iptal">‚ùå ƒ∞ptal</option>
                        </select>
                        <select id="filterTeamMember" onchange="filterProducts()">
                            <option value="all">üë• T√ºm Ekip</option>
                        </select>
                    </div>

                    <div class="products-grid" id="productsList"></div>
                </div>
            </div>

            <!-- My Tasks Tab -->
            <div id="myTasksTab" class="tab-content">
                <div class="content-card">
                    <h2>‚úÖ G√∂revlerim</h2>
                    <div class="products-grid" id="myTasksList"></div>
                </div>
            </div>

            <!-- Team Tab -->
            <div id="teamTab" class="tab-content">
                <div class="content-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                        <h2>üë• Ekip √úyeleri Y√∂netimi</h2>
                        <button class="btn" style="width: auto; padding: 12px 28px;" onclick="openAddTeamMemberModal()">‚ûï Yeni Ekip √úyesi Ekle</button>
                    </div>
                    <div class="team-grid" id="teamList"></div>
                </div>
            </div>

            <!-- Archive Tab -->
            <div id="archiveTab" class="tab-content">
                <div class="content-card">
                    <h2>üìÅ Tamamlanan Projeler Ar≈üivi</h2>
                    <div class="products-grid" id="archiveList"></div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="content-card">
                    <h2>‚öôÔ∏è Hesap Ayarlarƒ±</h2>
                    <div class="settings-card">
                        <h3>üîê Giri≈ü Bilgilerim</h3>
                        <div class="settings-item">
                            <strong>Kullanƒ±cƒ± Adƒ±</strong>
                            <input type="text" id="settingsUsername" readonly style="cursor: not-allowed; background: rgba(255,255,255,0.5);">
                        </div>
                        <div class="settings-item">
                            <strong>Yeni ≈ûifre (Bo≈ü bƒ±rakƒ±rsan deƒüi≈ümez)</strong>
                            <input type="password" id="settingsPassword" placeholder="Yeni ≈üifrenizi girin">
                        </div>
                        <button class="btn" onclick="updateMyCredentials()">üíæ Kaydet</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Yeni Proje Ekle</h3>
                <button class="close-modal" onclick="closeModal('addProductModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>üìù Proje Adƒ±</label>
                <input type="text" id="productName" placeholder="Proje adƒ±nƒ± girin">
            </div>
            <div class="form-group">
                <label>üîó √úr√ºn Linki</label>
                <input type="url" id="productLink" placeholder="https://...">
            </div>
            <div class="form-group">
                <label>üí∞ Satƒ±≈ü Fiyatƒ± (TL)</label>
                <input type="number" id="productPrice" placeholder="0">
            </div>
            <div class="form-group">
                <label>üë§ Ekip √úyesi Se√ß</label>
                <select id="teamMemberSelect"></select>
            </div>
            <div class="form-group">
                <label>üìã Not (Opsiyonel)</label>
                <textarea id="productNote" rows="3" placeholder="Ekstra bilgi veya talimatlar..."></textarea>
            </div>
            <button class="btn" onclick="addProduct()">‚úÖ Proje Ekle</button>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detailProductName">üì¶ Proje Detayƒ±</h3>
                <button class="close-modal" onclick="closeModal('productDetailModal')">&times;</button>
            </div>
            <div id="productDetailContent"></div>

            <h4 style="margin-top: 30px; color: #667eea; font-size: 18px; font-weight: 800;">üí¨ Yorumlar ve Mesajlar</h4>
            <div class="chat-container" id="chatContainer"></div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="Mesajƒ±nƒ±zƒ± yazƒ±n...">
                <button class="send-btn" onclick="sendMessage()">üì§ G√∂nder</button>
            </div>

            <h4 style="margin-top: 30px; color: #667eea; font-size: 18px; font-weight: 800;">üé• Videolar</h4>
            <div class="uploaded-files" id="uploadedFiles"></div>
            <div class="form-group" style="margin-top: 20px;">
                <label>üìπ Video Dosyalarƒ± Y√ºkle (.mp4, .mov, .avi vb.) - Birden fazla se√ßebilirsiniz</label>
                <input type="file" id="videoFile" accept="video/*" multiple style="padding: 8px;">
                <div id="uploadProgress" style="display:none; margin-top: 10px;">
                    <small id="progressText" style="color: #667eea; font-weight: 600;">Y√ºkleniyor...</small>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>üåê √úr√ºn√ºn Site Linki</label>
                <input type="url" id="siteLink" placeholder="Trendyol, n11, kendi siteniz vb.">
            </div>
            <button class="btn" id="uploadFilesBtn" onclick="uploadFiles()">üíæ Dosyalarƒ± Kaydet</button>
        </div>
    </div>

    <!-- Add Team Member Modal -->
    <div id="addTeamMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Yeni Ekip √úyesi Ekle</h3>
                <button class="close-modal" onclick="closeModal('addTeamMemberModal')">&times;</button>
            </div>
            <div class="form-group">
                <label>üë§ Ad Soyad</label>
                <input type="text" id="newMemberName" placeholder="√ñrn: Ali Yƒ±lmaz" oninput="generateUsername()">
            </div>
            <div class="form-group">
                <label>üîê Kullanƒ±cƒ± Adƒ± (Otomatik olu≈üturuldu)</label>
                <input type="text" id="newMemberUsername" readonly style="background: #f5f5f5; cursor: not-allowed;">
                <small style="color: #999; display: block; margin-top: 8px;">Bu kullanƒ±cƒ± adƒ± ile giri≈ü yapacak</small>
            </div>
            <div class="form-group">
                <label>üîë ≈ûifre</label>
                <input type="password" id="newMemberPassword" placeholder="G√ºvenli ≈üifre">
            </div>
            <button class="btn" onclick="addTeamMember()">‚úÖ Ekip √úyesi Ekle</button>
        </div>
    </div>

    <!-- Edit Team Member Modal -->
    <div id="editTeamMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Ekip √úyesini D√ºzenle</h3>
                <button class="close-modal" onclick="closeModal('editTeamMemberModal')">&times;</button>
            </div>
            <input type="hidden" id="editMemberUsername">
            <div class="form-group">
                <label>üë§ Ad Soyad</label>
                <input type="text" id="editMemberName" placeholder="√ñrn: Ali Yƒ±lmaz">
                <small style="color: #999; display: block; margin-top: 8px;">Kullanƒ±cƒ± adƒ± da otomatik g√ºncellenecek</small>
            </div>
            <div class="form-group">
                <label>üîë Yeni ≈ûifre (Bo≈ü bƒ±rakƒ±rsan deƒüi≈ümez)</label>
                <input type="password" id="editMemberPassword" placeholder="Yeni ≈üifre">
            </div>
            <button class="btn" onclick="saveTeamMemberEdit()">üíæ Kaydet</button>
            <button class="btn" style="background: #ff4757; margin-top: 12px;" onclick="deleteTeamMember()">üóëÔ∏è Ekip √úyesini Sil</button>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // IndexedDB Wrapper
        class VideoDB {
            constructor() {
                this.dbName = 'ProjeVideolarƒ±';
                this.dbVersion = 1;
                this.db = null;
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.dbVersion);

                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve();
                    };

                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('videos')) {
                            db.createObjectStore('videos', { keyPath: 'id', autoIncrement: true });
                        }
                    };
                });
            }

            async saveVideo(productId, videoData) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['videos'], 'readwrite');
                    const store = transaction.objectStore('videos');
                    const data = { productId, ...videoData };
                    const request = store.add(data);

                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getVideos(productId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['videos'], 'readonly');
                    const store = transaction.objectStore('videos');
                    const request = store.getAll();

                    request.onsuccess = () => {
                        const allVideos = request.result;
                        const productVideos = allVideos.filter(v => v.productId === productId);
                        resolve(productVideos);
                    };
                    request.onerror = () => reject(request.error);
                });
            }

            async deleteVideo(videoId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['videos'], 'readwrite');
                    const store = transaction.objectStore('videos');
                    const request = store.delete(videoId);

                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }

            async deleteProductVideos(productId) {
                const videos = await this.getVideos(productId);
                for (const video of videos) {
                    await this.deleteVideo(video.id);
                }
            }
        }

        // Initialize VideoDB
        const videoDB = new VideoDB();
        videoDB.init().then(() => {
            console.log('Video veritabanƒ± hazƒ±r! üé•');
        }).catch(err => {
            console.error('Video veritabanƒ± hatasƒ±:', err);
        });

        // LocalStorage Data Management (video hari√ß)
        const DB = {
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            },
            clear: () => {
                // Sadece currentUser hari√ß her ≈üeyi temizle
                const currentUser = localStorage.getItem('currentUser');
                localStorage.clear();
                if (currentUser) {
                    localStorage.setItem('currentUser', currentUser);
                }
                // IndexedDB'yi de temizle
                indexedDB.deleteDatabase('ProjeVideolarƒ±');
            },
            init: () => {
                if (!DB.get('users')) {
                    DB.set('users', {
                        'hakan': {
                            username: 'hakan',
                            password: 'hakan123',
                            role: 'admin',
                            name: 'Hakan'
                        }
                    });
                }
                
                if (!DB.get('products')) {
                    DB.set('products', {});
                }
                
                if (!DB.get('activities')) {
                    DB.set('activities', []);
                }
            }
        };

        // ƒ∞lk y√ºkleme: Eski verileri temizle
        if (!localStorage.getItem('system_initialized')) {
            DB.clear();
            localStorage.setItem('system_initialized', 'true');
        }

        DB.init();

        let currentUser = null;
        let currentProductId = null;
        let allProducts = [];

        window.login = function() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showNotification('Kullanƒ±cƒ± adƒ± ve ≈üifre gerekli!', 'error');
                return;
            }

            const users = DB.get('users');
            const user = users[username];

            if (user && user.password === password) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                document.getElementById('userBadge').textContent = currentUser.name;

                if (currentUser.role === 'team') {
                    document.getElementById('tabMyTasks').style.display = 'block';
                    document.getElementById('addProductBtn').style.display = 'none';
                    document.getElementById('tabTeam').style.display = 'none';
                    document.getElementById('settingsBtn').style.display = 'flex';
                } else {
                    document.getElementById('tabTeam').style.display = 'block';
                    document.getElementById('settingsBtn').style.display = 'flex';
                }

                loadTeamMembers();
                loadProducts();
                updateDashboard();
                showNotification('Ho≈ü geldiniz, ' + currentUser.name + '! üéâ', 'success');
            } else {
                showNotification('Kullanƒ±cƒ± adƒ± veya ≈üifre hatalƒ±!', 'error');
            }
        };

        window.logout = function() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
        };

        // Auto login if saved
        window.addEventListener('load', () => {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                document.getElementById('userBadge').textContent = currentUser.name;

                if (currentUser.role === 'team') {
                    document.getElementById('tabMyTasks').style.display = 'block';
                    document.getElementById('addProductBtn').style.display = 'none';
                    document.getElementById('tabTeam').style.display = 'none';
                    document.getElementById('settingsBtn').style.display = 'flex';
                } else {
                    document.getElementById('tabTeam').style.display = 'block';
                    document.getElementById('settingsBtn').style.display = 'flex';
                }

                loadTeamMembers();
                loadProducts();
                updateDashboard();
            }
        });

        window.switchTab = function(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (event && event.target) {
                event.target.classList.add('active');
            }
            document.getElementById(tabName + 'Tab').classList.add('active');

            if (tabName === 'myTasks') {
                loadMyTasks();
            } else if (tabName === 'archive') {
                loadArchive();
            } else if (tabName === 'team') {
                loadTeamDetails();
            } else if (tabName === 'settings') {
                loadSettings();
            }
        };

        window.loadSettings = function() {
            document.getElementById('settingsUsername').value = currentUser.username;
            document.getElementById('settingsPassword').value = '';
        };

        window.updateMyCredentials = function() {
            const newPassword = document.getElementById('settingsPassword').value;

            if (!newPassword) {
                showNotification('L√ºtfen yeni ≈üifrenizi girin!', 'error');
                return;
            }

            const users = DB.get('users');
            users[currentUser.username].password = newPassword;
            currentUser.password = newPassword;

            DB.set('users', users);
            localStorage.setItem('currentUser', JSON.stringify(currentUser));

            document.getElementById('settingsPassword').value = '';
            showNotification('≈ûifreniz ba≈üarƒ±yla g√ºncellendi! üéâ', 'success');
            addActivity(`${currentUser.name}, ≈üifresini g√ºncelledi`);
        };

        window.loadTeamMembers = function() {
            const users = DB.get('users');
            const teamSelect = document.getElementById('teamMemberSelect');
            const filterSelect = document.getElementById('filterTeamMember');
            
            teamSelect.innerHTML = '<option value="">üë§ Ekip √ºyesi se√ßin</option>';
            filterSelect.innerHTML = '<option value="all">üë• T√ºm Ekip</option>';

            Object.entries(users).forEach(([key, user]) => {
                if (user.role === 'team') {
                    teamSelect.innerHTML += `<option value="${key}">${user.name}</option>`;
                    filterSelect.innerHTML += `<option value="${key}">${user.name}</option>`;
                }
            });
        };

        window.openAddProductModal = function() {
            document.getElementById('productName').value = '';
            document.getElementById('productLink').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('teamMemberSelect').value = '';
            document.getElementById('productNote').value = '';
            document.getElementById('addProductModal').classList.add('active');
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).classList.remove('active');
        };

        window.addProduct = function() {
            const name = document.getElementById('productName').value.trim();
            const link = document.getElementById('productLink').value.trim();
            const price = document.getElementById('productPrice').value;
            const teamMember = document.getElementById('teamMemberSelect').value;
            const note = document.getElementById('productNote').value.trim();

            if (!name || !link || !price || !teamMember) {
                showNotification('T√ºm alanlarƒ± doldurun!', 'error');
                return;
            }

            const products = DB.get('products');
            const productId = 'prod_' + Date.now();

            products[productId] = {
                id: productId,
                name,
                link,
                price: parseFloat(price),
                assignedTo: teamMember,
                assignedBy: currentUser.username,
                status: 'beklemede',
                note,
                createdAt: new Date().toISOString(),
                messages: [],
                adActive: false,
                siteLink: ''
            };

            DB.set('products', products);
            addActivity(`${currentUser.name}, ${name} projesini ${teamMember} ekip √ºyesine atadƒ±`);

            closeModal('addProductModal');
            showNotification('Proje ba≈üarƒ±yla eklendi! üéâ', 'success');
            loadProducts();
        };

        window.loadProducts = function() {
            const products = DB.get('products');
            allProducts = Object.values(products);
            filterProducts();
        };

        window.filterProducts = function() {
            const statusFilter = document.getElementById('filterStatus').value;
            const teamFilter = document.getElementById('filterTeamMember').value;

            let filtered = allProducts.filter(p => p.status !== 'tamamlandi' && p.status !== 'iptal');

            if (currentUser.role === 'team') {
                filtered = filtered.filter(p => p.assignedTo === currentUser.username);
            }

            if (statusFilter !== 'all') {
                filtered = filtered.filter(p => p.status === statusFilter);
            }

            if (teamFilter !== 'all') {
                filtered = filtered.filter(p => p.assignedTo === teamFilter);
            }

            displayProducts(filtered, 'productsList');
        };

        window.displayProducts = async function(products, containerId) {
            const container = document.getElementById(containerId);

            if (products.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <p>Hen√ºz proje bulunmuyor</p>
                    </div>
                `;
                return;
            }

            const users = DB.get('users');

            // Video sayƒ±larƒ±nƒ± al
            const videoCountPromises = products.map(async (product) => {
                const videos = await videoDB.getVideos(product.id);
                return { productId: product.id, count: videos.length };
            });

            const videoCounts = await Promise.all(videoCountPromises);
            const videoCountMap = {};
            videoCounts.forEach(vc => {
                videoCountMap[vc.productId] = vc.count;
            });

            container.innerHTML = products.map(product => {
                const assignedUser = users[product.assignedTo];
                const statusText = {
                    'beklemede': 'Beklemede',
                    'devam': 'Devam Ediyor',
                    'tamamlandi': 'Tamamlandƒ±',
                    'iptal': 'ƒ∞ptal Edildi'
                };

                const createdDate = new Date(product.createdAt).toLocaleDateString('tr-TR');
                const messageCount = product.messages ? product.messages.length : 0;
                const videoCount = videoCountMap[product.id] || 0;

                return `
                    <div class="product-card">
                        <div class="product-header">
                            <div class="product-title">üì¶ ${product.name}</div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <div class="status-badge status-${product.status}">${statusText[product.status]}</div>
                                ${product.adActive ? '<div class="ad-active-badge">üì¢ Reklam Aktif</div>' : ''}
                            </div>
                        </div>
                        <div class="product-details">
                            <div class="product-detail">
                                <strong>üë§ Atanan:</strong> ${assignedUser ? assignedUser.name : 'Bilinmiyor'}
                            </div>
                            <div class="product-detail">
                                <strong>üí∞ Fiyat:</strong> ${product.price} TL
                            </div>
                            <div class="product-detail">
                                <strong>üìÖ Tarih:</strong> ${createdDate}
                            </div>
                            <div class="product-detail">
                                <strong>üîó Link:</strong> <a href="${product.link}" target="_blank" style="color: #667eea;">√úr√ºn√º G√∂r√ºnt√ºle</a>
                            </div>
                            ${product.note ? `<div class="product-detail"><strong>üìù Not:</strong> ${product.note}</div>` : ''}
                            <div class="product-detail">
                                <strong>üí¨ Mesaj:</strong> ${messageCount} ‚Ä¢ <strong>üé• Video:</strong> ${videoCount}
                            </div>
                        </div>
                        <div class="product-actions">
                            <button class="action-btn btn-primary" onclick="openProductDetail('${product.id}')">üìã Detay</button>
                            ${currentUser.role === 'admin' && !product.adActive ? 
                                `<button class="action-btn btn-ad" onclick="markAdActive('${product.id}')">üì¢ Reklam A√ßƒ±ldƒ±</button>` : ''}
                            ${currentUser.role === 'team' && product.assignedTo === currentUser.username && product.status === 'beklemede' ? 
                                `<button class="action-btn btn-warning" onclick="updateProductStatus('${product.id}', 'devam')">‚ñ∂Ô∏è Ba≈ülat</button>` : ''}
                            ${currentUser.role === 'team' && product.assignedTo === currentUser.username && product.status === 'devam' ? 
                                `<button class="action-btn btn-success" onclick="updateProductStatus('${product.id}', 'tamamlandi')">‚úÖ Tamamla</button>` : ''}
                            ${currentUser.role === 'admin' ? 
                                `<button class="action-btn btn-danger" onclick="updateProductStatus('${product.id}', 'iptal')">‚ùå ƒ∞ptal</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        };

        window.markAdActive = function(productId) {
            const products = DB.get('products');
            const product = products[productId];

            product.adActive = true;
            product.adActivatedAt = new Date().toISOString();

            DB.set('products', products);
            showNotification('Reklam durumu g√ºncellendi! üì¢', 'success');
            addActivity(`${currentUser.name}, ${product.name} projesinin reklamƒ±nƒ± a√ßtƒ±`);
            loadProducts();
        };

        window.openProductDetail = async function(productId) {
            currentProductId = productId;
            const products = DB.get('products');
            const product = products[productId];

            if (!product) return;

            const users = DB.get('users');
            const assignedUser = users[product.assignedTo];

            document.getElementById('detailProductName').textContent = 'üì¶ ' + product.name;

            const statusText = {
                'beklemede': 'Beklemede',
                'devam': 'Devam Ediyor',
                'tamamlandi': 'Tamamlandƒ±',
                'iptal': 'ƒ∞ptal Edildi'
            };

            document.getElementById('productDetailContent').innerHTML = `
                <div class="product-detail"><strong>üë§ Atanan:</strong> ${assignedUser ? assignedUser.name : 'Bilinmiyor'}</div>
                <div class="product-detail"><strong>üìä Durum:</strong> <span class="status-badge status-${product.status}">${statusText[product.status]}</span> ${product.adActive ? '<span class="ad-active-badge">üì¢ Reklam Aktif</span>' : ''}</div>
                <div class="product-detail"><strong>üí∞ Fiyat:</strong> ${product.price} TL</div>
                <div class="product-detail"><strong>üìÖ Tarih:</strong> ${new Date(product.createdAt).toLocaleDateString('tr-TR', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</div>
                <div class="product-detail"><strong>üîó √úr√ºn Linki:</strong> <a href="${product.link}" target="_blank" class="file-link">Linke Git</a></div>
                ${product.note ? `<div class="product-detail"><strong>üìù Not:</strong> ${product.note}</div>` : ''}
            `;

            loadMessages(product.messages || []);

            // IndexedDB'den videolarƒ± y√ºkle
            const videos = await videoDB.getVideos(productId);
            
            const filesHtml = [];
            if (videos.length > 0) {
                videos.forEach((video) => {
                    const fileSize = (video.size / 1024 / 1024).toFixed(2);
                    const uploadDate = new Date(video.uploadedAt).toLocaleDateString('tr-TR');
                    filesHtml.push(`
                        <div class="file-item">
                            <div style="flex: 1;">
                                <a href="${video.data}" download="${video.name}" class="file-link">
                                    üé• ${video.name}
                                </a>
                                <small style="color: #999; display: block; margin-top: 5px;">${fileSize} MB ‚Ä¢ ${uploadDate}</small>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="action-btn btn-primary" onclick="playVideo('${video.data}', '${video.type}')">‚ñ∂Ô∏è Oynat</button>
                                <button class="action-btn btn-danger" onclick="deleteVideo(${video.id})">üóëÔ∏è Sil</button>
                            </div>
                        </div>
                    `);
                });
            }

            if (product.siteLink) {
                filesHtml.push(`
                    <div class="file-item">
                        <a href="${product.siteLink}" target="_blank" class="file-link">üåê √úr√ºn√ºn Site Linki</a>
                    </div>
                `);
            }

            document.getElementById('uploadedFiles').innerHTML = filesHtml.length > 0 ? 
                filesHtml.join('') : 
                '<p style="color: #999; text-align: center; padding: 20px;">Hen√ºz dosya y√ºklenmemi≈ü</p>';

            document.getElementById('videoFile').value = '';
            document.getElementById('siteLink').value = product.siteLink || '';
            document.getElementById('uploadProgress').style.display = 'none';

            document.getElementById('productDetailModal').classList.add('active');
        };

        window.loadMessages = function(messages) {
            const container = document.getElementById('chatContainer');
            
            if (!messages || messages.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">Hen√ºz mesaj yok</p>';
                return;
            }

            container.innerHTML = messages.map(msg => `
                <div class="chat-message ${msg.role === 'admin' ? 'admin' : ''}">
                    <div class="chat-header">
                        <span class="chat-author">${msg.author}</span>
                        <span class="chat-time">${new Date(msg.timestamp).toLocaleString('tr-TR')}</span>
                    </div>
                    <div class="chat-text">${msg.text}</div>
                </div>
            `).join('');

            container.scrollTop = container.scrollHeight;
        };

        window.sendMessage = function() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();

            if (!text || !currentProductId) return;

            const products = DB.get('products');
            const product = products[currentProductId];

            if (!product.messages) product.messages = [];

            product.messages.push({
                author: currentUser.name,
                role: currentUser.role,
                text,
                timestamp: new Date().toISOString()
            });

            DB.set('products', products);
            loadMessages(product.messages);
            input.value = '';

            addActivity(`${currentUser.name}, ${product.name} projesine yorum yaptƒ±`);
        };

        window.uploadFiles = async function() {
            const videoFiles = document.getElementById('videoFile').files;
            const siteLink = document.getElementById('siteLink').value.trim();

            if (videoFiles.length === 0 && !siteLink) {
                showNotification('En az bir dosya veya link girin!', 'error');
                return;
            }

            const saveBtn = document.getElementById('uploadFilesBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = '‚è≥ Y√ºkleniyor...';

            const progressDiv = document.getElementById('uploadProgress');
            const progressText = document.getElementById('progressText');
            const progressFill = document.getElementById('progressFill');
            progressDiv.style.display = 'block';

            try {
                const products = DB.get('products');
                const product = products[currentProductId];

                if (!product) {
                    throw new Error('Proje bulunamadƒ±!');
                }

                // Site linkini g√ºncelle
                if (siteLink) {
                    product.siteLink = siteLink;
                    DB.set('products', products);
                }

                // Video dosyalarƒ± varsa
                if (videoFiles.length > 0) {
                    console.log(`${videoFiles.length} video y√ºkleniyor...`);
                    
                    for (let i = 0; i < videoFiles.length; i++) {
                        const videoFile = videoFiles[i];
                        
                        // Progress g√ºncelle
                        const progress = Math.round(((i + 1) / videoFiles.length) * 100);
                        progressText.textContent = `${i + 1}/${videoFiles.length} video y√ºkleniyor...`;
                        progressFill.style.width = progress + '%';
                        
                        // Boyut kontrol√º
                        const maxSize = 100 * 1024 * 1024; // 100MB
                        if (videoFile.size > maxSize) {
                            showNotification(`"${videoFile.name}" √ßok b√ºy√ºk (max 100MB)!`, 'error');
                            continue;
                        }

                        console.log(`Video okunuyor: ${videoFile.name}`);
                        
                        // Dosyayƒ± oku
                        const videoData = await readFileAsDataURL(videoFile);
                        
                        // IndexedDB'ye kaydet
                        await videoDB.saveVideo(currentProductId, {
                            name: videoFile.name,
                            type: videoFile.type,
                            size: videoFile.size,
                            data: videoData,
                            uploadedAt: new Date().toISOString()
                        });
                        
                        console.log(`Video eklendi: ${videoFile.name}`);
                    }
                }

                // Ba≈üarƒ± mesajƒ±
                if (videoFiles.length > 0) {
                    showNotification(`${videoFiles.length} video ba≈üarƒ±yla y√ºklendi! üéâ`, 'success');
                    addActivity(`${currentUser.name}, ${product.name} projesi i√ßin ${videoFiles.length} video y√ºkledi`);
                } else if (siteLink) {
                    showNotification('Site linki kaydedildi! üéâ', 'success');
                    addActivity(`${currentUser.name}, ${product.name} projesi i√ßin site linki ekledi`);
                }

                // Modal'ƒ± kapat ve g√ºncelle
                closeModal('productDetailModal');
                loadProducts();

            } catch (error) {
                console.error('Y√ºkleme hatasƒ±:', error);
                showNotification('Y√ºkleme sƒ±rasƒ±nda hata olu≈ütu: ' + error.message, 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.textContent = 'üíæ Dosyalarƒ± Kaydet';
                progressDiv.style.display = 'none';
            }
        };

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('Dosya okunamadƒ±'));
                reader.readAsDataURL(file);
            });
        }

        window.deleteVideo = async function(videoId) {
            if (!confirm('Bu videoyu silmek istediƒüinize emin misiniz?')) {
                return;
            }

            try {
                await videoDB.deleteVideo(videoId);
                
                const products = DB.get('products');
                const product = products[currentProductId];
                
                showNotification('Video silindi! üóëÔ∏è', 'success');
                addActivity(`${currentUser.name}, ${product.name} projesinden bir video sildi`);
                openProductDetail(currentProductId);
            } catch (error) {
                console.error('Video silme hatasƒ±:', error);
                showNotification('Video silinirken hata olu≈ütu!', 'error');
            }
        };

        window.playVideo = function(dataUrl, mimeType) {
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>üé• Video Oynatƒ±cƒ±</title>
                    <style>
                        body {
                            margin: 0;
                            padding: 20px;
                            background: linear-gradient(135deg, #667eea, #764ba2);
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            min-height: 100vh;
                        }
                        video {
                            max-width: 100%;
                            max-height: 90vh;
                            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                            border-radius: 15px;
                        }
                    </style>
                </head>
                <body>
                    <video controls autoplay>
                        <source src="${dataUrl}" type="${mimeType}">
                        Tarayƒ±cƒ±nƒ±z video oynatmayƒ± desteklemiyor.
                    </video>
                </body>
                </html>
            `);
        };

        window.updateProductStatus = async function(productId, newStatus) {
            const products = DB.get('products');
            const product = products[productId];

            product.status = newStatus;
            product.updatedAt = new Date().toISOString();

            DB.set('products', products);

            const statusText = {
                'beklemede': 'beklemeye aldƒ±',
                'devam': 'ba≈ülattƒ±',
                'tamamlandi': 'tamamladƒ±',
                'iptal': 'iptal etti'
            };

            // ƒ∞ptal veya tamamlandƒ±ysa videolarƒ± sil
            if (newStatus === 'iptal') {
                await videoDB.deleteProductVideos(productId);
            }

            addActivity(`${currentUser.name}, ${product.name} projesini ${statusText[newStatus]}`);
            showNotification('Durum g√ºncellendi! üéâ', 'success');
            loadProducts();
            
            if (document.getElementById('productDetailModal').classList.contains('active')) {
                openProductDetail(productId);
            }
        };

        window.loadMyTasks = function() {
            const myTasks = allProducts.filter(p => 
                p.assignedTo === currentUser.username && 
                p.status !== 'tamamlandi' && 
                p.status !== 'iptal'
            );
            displayProducts(myTasks, 'myTasksList');
        };

        window.loadArchive = function() {
            let archived = allProducts.filter(p => 
                p.status === 'tamamlandi' || p.status === 'iptal'
            );
            
            if (currentUser.role === 'team') {
                archived = archived.filter(p => p.assignedTo === currentUser.username);
            }
            
            displayProducts(archived, 'archiveList');
        };

        window.updateDashboard = function() {
            let dashboardProducts = allProducts;
            
            if (currentUser.role === 'team') {
                dashboardProducts = allProducts.filter(p => p.assignedTo === currentUser.username);
            }
            
            const activeProducts = dashboardProducts.filter(p => p.status !== 'tamamlandi' && p.status !== 'iptal');
            
            document.getElementById('totalProducts').textContent = activeProducts.length;
            document.getElementById('pendingProducts').textContent = activeProducts.filter(p => p.status === 'beklemede').length;
            document.getElementById('inProgressProducts').textContent = activeProducts.filter(p => p.status === 'devam').length;
            document.getElementById('completedProducts').textContent = dashboardProducts.filter(p => p.status === 'tamamlandi').length;

            const users = DB.get('users');

            if (currentUser.role === 'admin') {
                const teamPerformance = Object.entries(users)
                    .filter(([key, user]) => user.role === 'team')
                    .map(([key, user]) => {
                        const userProducts = allProducts.filter(p => p.assignedTo === key);
                        return {
                            name: user.name,
                            total: userProducts.length,
                            completed: userProducts.filter(p => p.status === 'tamamlandi').length,
                            inProgress: userProducts.filter(p => p.status === 'devam').length,
                            pending: userProducts.filter(p => p.status === 'beklemede').length
                        };
                    });

                document.getElementById('teamPerformance').innerHTML = teamPerformance.map(member => `
                    <div class="team-card">
                        <h3>üë§ ${member.name}</h3>
                        <div class="team-stat">
                            <span>Toplam:</span>
                            <strong>${member.total}</strong>
                        </div>
                        <div class="team-stat">
                            <span>‚úÖ Tamamlanan:</span>
                            <strong>${member.completed}</strong>
                        </div>
                        <div class="team-stat">
                            <span>‚è≥ Devam Eden:</span>
                            <strong>${member.inProgress}</strong>
                        </div>
                        <div class="team-stat">
                            <span>‚è∏Ô∏è Bekleyen:</span>
                            <strong>${member.pending}</strong>
                        </div>
                    </div>
                `).join('');
            } else {
                document.getElementById('teamPerformance').innerHTML = `
                    <div class="team-card">
                        <h3>üìä Benim Performansƒ±m</h3>
                        <div class="team-stat">
                            <span>Toplam:</span>
                            <strong>${dashboardProducts.length}</strong>
                        </div>
                        <div class="team-stat">
                            <span>‚úÖ Tamamlanan:</span>
                            <strong>${dashboardProducts.filter(p => p.status === 'tamamlandi').length}</strong>
                        </div>
                        <div class="team-stat">
                            <span>‚è≥ Devam Eden:</span>
                            <strong>${dashboardProducts.filter(p => p.status === 'devam').length}</strong>
                        </div>
                        <div class="team-stat">
                            <span>‚è∏Ô∏è Bekleyen:</span>
                            <strong>${dashboardProducts.filter(p => p.status === 'beklemede').length}</strong>
                        </div>
                    </div>
                `;
            }

            loadActivities();
        };

        window.addActivity = function(text) {
            const activities = DB.get('activities');
            activities.unshift({
                text,
                timestamp: new Date().toISOString()
            });
            
            if (activities.length > 50) {
                activities.splice(50);
            }
            
            DB.set('activities', activities);
        };

        window.loadActivities = function() {
            let activities = DB.get('activities').slice(0, 10);
            
            if (currentUser.role === 'team') {
                activities = activities.filter(act => 
                    act.text.includes(currentUser.name)
                );
            }

            if (activities.length === 0) {
                document.getElementById('activityTimeline').innerHTML = '<p style="color: #999;">Hen√ºz aktivite yok</p>';
                return;
            }

            document.getElementById('activityTimeline').innerHTML = activities.map(activity => `
                <div class="timeline-item">
                    <div class="timeline-date">${new Date(activity.timestamp).toLocaleString('tr-TR')}</div>
                    <div class="timeline-content">${activity.text}</div>
                </div>
            `).join('');
        };

        window.loadTeamDetails = function() {
            const users = DB.get('users');

            const teamMembers = Object.entries(users)
                .filter(([key, user]) => user.role === 'team')
                .map(([key, user]) => {
                    const userProducts = allProducts.filter(p => p.assignedTo === key);
                    const avgTime = calculateAverageCompletionTime(userProducts);
                    
                    return {
                        username: key,
                        name: user.name,
                        total: userProducts.length,
                        completed: userProducts.filter(p => p.status === 'tamamlandi').length,
                        inProgress: userProducts.filter(p => p.status === 'devam').length,
                        pending: userProducts.filter(p => p.status === 'beklemede').length,
                        avgTime
                    };
                });

            document.getElementById('teamList').innerHTML = teamMembers.map(member => `
                <div class="team-card">
                    <h3>üë§ ${member.name}</h3>
                    <div class="team-stat">
                        <span>Toplam G√∂rev:</span>
                        <strong>${member.total}</strong>
                    </div>
                    <div class="team-stat">
                        <span>‚úÖ Tamamlanan:</span>
                        <strong>${member.completed}</strong>
                    </div>
                    <div class="team-stat">
                        <span>‚è≥ Devam Eden:</span>
                        <strong>${member.inProgress}</strong>
                    </div>
                    <div class="team-stat">
                        <span>‚è∏Ô∏è Bekleyen:</span>
                        <strong>${member.pending}</strong>
                    </div>
                    <div class="team-stat">
                        <span>‚è±Ô∏è Ort. S√ºre:</span>
                        <strong>${member.avgTime}</strong>
                    </div>
                    <div class="team-stat">
                        <span>üìä Ba≈üarƒ± Oranƒ±:</span>
                        <strong>${member.total > 0 ? Math.round((member.completed / member.total) * 100) : 0}%</strong>
                    </div>
                    <button class="btn" style="margin-top: 20px;" onclick="openEditTeamMemberModal('${member.username}')">‚úèÔ∏è D√ºzenle</button>
                </div>
            `).join('');
        };

        window.openAddTeamMemberModal = function() {
            document.getElementById('newMemberName').value = '';
            document.getElementById('newMemberUsername').value = '';
            document.getElementById('newMemberPassword').value = '';
            document.getElementById('addTeamMemberModal').classList.add('active');
        };

        window.generateUsername = function() {
            const name = document.getElementById('newMemberName').value.trim();
            if (!name) {
                document.getElementById('newMemberUsername').value = '';
                return;
            }

            let username = name.toLowerCase()
                .replace(/ƒü/g, 'g')
                .replace(/√º/g, 'u')
                .replace(/≈ü/g, 's')
                .replace(/ƒ±/g, 'i')
                .replace(/√∂/g, 'o')
                .replace(/√ß/g, 'c')
                .replace(/[^a-z0-9]/g, '');

            const users = DB.get('users');
            let finalUsername = username;
            let counter = 1;
            
            while (users[finalUsername]) {
                finalUsername = username + counter;
                counter++;
            }

            document.getElementById('newMemberUsername').value = finalUsername;
        };

        window.addTeamMember = function() {
            const name = document.getElementById('newMemberName').value.trim();
            const username = document.getElementById('newMemberUsername').value.trim();
            const password = document.getElementById('newMemberPassword').value;

            if (!name || !username || !password) {
                showNotification('T√ºm alanlarƒ± doldurun!', 'error');
                return;
            }

            const users = DB.get('users');

            if (users[username]) {
                showNotification('Bu kullanƒ±cƒ± adƒ± zaten kullanƒ±lƒ±yor!', 'error');
                return;
            }

            users[username] = {
                username: username,
                password: password,
                role: 'team',
                name: name
            };

            DB.set('users', users);
            closeModal('addTeamMemberModal');
            showNotification(`${name} ba≈üarƒ±yla eklendi! Kullanƒ±cƒ± adƒ±: ${username} üéâ`, 'success');
            loadTeamMembers();
            loadTeamDetails();
            addActivity(`${currentUser.name}, ${name} adlƒ± yeni ekip √ºyesi ekledi`);
        };

        window.openEditTeamMemberModal = function(username) {
            const users = DB.get('users');
            const user = users[username];

            document.getElementById('editMemberUsername').value = username;
            document.getElementById('editMemberName').value = user.name;
            document.getElementById('editMemberPassword').value = '';
            document.getElementById('editTeamMemberModal').classList.add('active');
        };

        window.saveTeamMemberEdit = function() {
            const oldUsername = document.getElementById('editMemberUsername').value;
            const name = document.getElementById('editMemberName').value.trim();
            const password = document.getElementById('editMemberPassword').value;

            if (!name) {
                showNotification('ƒ∞sim bo≈ü olamaz!', 'error');
                return;
            }

            const users = DB.get('users');
            const oldUser = users[oldUsername];

            let newUsername = name.toLowerCase()
                .replace(/ƒü/g, 'g')
                .replace(/√º/g, 'u')
                .replace(/≈ü/g, 's')
                .replace(/ƒ±/g, 'i')
                .replace(/√∂/g, 'o')
                .replace(/√ß/g, 'c')
                .replace(/[^a-z0-9]/g, '');

            let finalUsername = newUsername;
            let counter = 1;
            
            while (users[finalUsername] && finalUsername !== oldUsername) {
                finalUsername = newUsername + counter;
                counter++;
            }

            if (finalUsername !== oldUsername) {
                users[finalUsername] = {
                    username: finalUsername,
                    password: password || oldUser.password,
                    role: 'team',
                    name: name
                };

                delete users[oldUsername];

                const products = DB.get('products');
                Object.keys(products).forEach(key => {
                    if (products[key].assignedTo === oldUsername) {
                        products[key].assignedTo = finalUsername;
                    }
                });
                DB.set('products', products);
            } else {
                users[oldUsername].name = name;
                if (password) {
                    users[oldUsername].password = password;
                }
            }

            DB.set('users', users);
            closeModal('editTeamMemberModal');
            showNotification(`${name} g√ºncellendi! Yeni kullanƒ±cƒ± adƒ±: ${finalUsername} üéâ`, 'success');
            loadTeamMembers();
            loadTeamDetails();
            loadProducts();
            addActivity(`${currentUser.name}, ${name} ekip √ºyesini g√ºncelledi`);
        };

        window.deleteTeamMember = async function() {
            if (!confirm('Bu ekip √ºyesini silmek istediƒüinize emin misiniz? Atanan t√ºm g√∂revler kaybolacak!')) {
                return;
            }

            const username = document.getElementById('editMemberUsername').value;
            const users = DB.get('users');
            const memberName = users[username].name;

            delete users[username];
            DB.set('users', users);

            const products = DB.get('products');
            for (const key in products) {
                if (products[key].assignedTo === username) {
                    // Videolarƒ± sil
                    await videoDB.deleteProductVideos(key);
                    delete products[key];
                }
            }
            DB.set('products', products);

            closeModal('editTeamMemberModal');
            showNotification('Ekip √ºyesi silindi! üóëÔ∏è', 'success');
            loadTeamMembers();
            loadTeamDetails();
            loadProducts();
            addActivity(`${currentUser.name}, ${memberName} ekip √ºyesini sildi`);
        };

        window.calculateAverageCompletionTime = function(products) {
            const completed = products.filter(p => p.status === 'tamamlandi' && p.updatedAt);
            
            if (completed.length === 0) return 'N/A';

            const totalHours = completed.reduce((sum, p) => {
                const start = new Date(p.createdAt);
                const end = new Date(p.updatedAt);
                const hours = (end - start) / (1000 * 60 * 60);
                return sum + hours;
            }, 0);

            const avgHours = totalHours / completed.length;
            
            if (avgHours < 24) {
                return Math.round(avgHours) + ' saat';
            } else {
                return Math.round(avgHours / 24) + ' g√ºn';
            }
        };

        window.showNotification = function(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        };

        // Enter key support
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('loginPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') login();
            });
            
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendMessage();
                });
            }
        });
    </script>
</body>
</html>
